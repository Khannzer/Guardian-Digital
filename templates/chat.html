<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!DOCTYPE html>
<html>
	<head>
		<title>Agente Guardian Digital</title>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">

		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}"/>
	</head>
	
	
	<body>
		<div class="modal fade" id="termsModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
			<div class="modal-content shadow-lg">
			
			<div class="modal-header bg-dark text-white">
				<h5 class="modal-title">
				<i class="fas fa-file-contract"></i> Términos y Condiciones
				</h5>
			</div>

			<div class="modal-body" style="max-height: 400px; overflow-y: auto;">

				<p>
				Bienvenido a Guardian Digital.
				</p>

				<p>
				1.- Naturaleza del Servicio (No médico):
				Guardián Digital es una herramienta de inteligencia artificial diseñada para brindar contención emocional inicial basándose en guías clínicas (mhGAP). No es un sustituto de diagnóstico, terapia psicológica ni atención médica profesional. 
				Guardián Digital está diseñado exclusivamente para brindar orientación psicológica general, apoyo emocional inicial y contención basada en guías clínicas reconocidas. El servicio no está destinado a responder consultas médicas especializadas, asesoramiento legal, diagnóstico clínico, prescripción de tratamientos, ni resolver asuntos ajenos al ámbito del bienestar emocional y la salud mental.
				</p>

				<p>
				2.- Casos de Emergencia:
				Si te encuentras en una situación de crisis severa, riesgo de autolesión o suicidio, este chat no es el medio adecuado. Por favor, comunícate de inmediato a la *Línea 113 (Opción 5) del MINSA, al 105 (Policía), o acude a urgencias.
				</p>

				<p>
				3.- Privacidad y Anonimato
				Tu uso de la plataforma es confidencial y anónimo. Los datos de la conversación se procesan temporalmente bajo la Ley N° 29733 (Ley de Protección de Datos Personales del Perú) con el único fin de generar respuestas, sin vincularlos a tu identidad.
				</p>

				<p>
				4.- Limitación de Responsabilidad y Naturaleza de la IA
				Al interactuar con una Inteligencia Artificial, comprendes que las respuestas pueden presentar imprecisiones tecnológicas. El equipo desarrollador no se hace responsable por las decisiones o acciones tomadas en base a la información del chat.
				</p>

				<p>
				5.- Disponibilidad del Servicio:
				El servicio puede presentar interrupciones técnicas o mantenimiento sin previo aviso. No se garantiza disponibilidad continua o libre de errores.
				</p>

				<p>
				6.- Modificaciones a los Términos:
				Los términos y condiciones pueden actualizarse en cualquier momento. El uso continuado del servicio implica la aceptación de las modificaciones.
				</p>

				<p>
				En caso de emergencia, comuníquese con los servicios de salud correspondientes.
				Guardián Digital no sustituye redes de apoyo humano. Se recomienda mantener contacto con familiares, amigos o profesionales de salud ante cualquier situación emocional difícil.
				</p>

				<hr>

				<div class="form-check mt-3">
				<input type="checkbox" class="form-check-input" id="acceptCheck">
				<label class="form-check-label" for="acceptCheck">
					He leído y acepto los términos y condiciones
				</label>
				</div>

			</div>

			<div class="modal-footer">
				<button type="button" id="rejectBtn" class="btn btn-danger">
				Rechazar
				</button>

				<button type="button" id="acceptBtn" class="btn btn-success" disabled>
				Aceptar
				</button>
			</div>

			</div>
		</div>
		</div>

		<div class="container-fluid h-100">
			<div class="row h-100">

		<!-- PANEL IZQUIERDO -->
		<div class="col-md-4 col-xl-3 border-right p-3" id="infoPanel">
			<h5 class="mb-3"><i class="fas fa-info-circle"></i> Información</h5>
			<hr>

			<div id="chatInfo">
				<p><strong>Estado:</strong> Activo</p>
				<p><strong>Mensajes enviados:</strong> <span id="msgCount">0</span></p>
				<p><strong>Hora inicio:</strong> <span id="startTime"></span></p>
			</div>

			<hr>

			<button class="btn btn-outline-primary btn-sm btn-block" id="">
				Cambiar a tema 
			</button>

			<button class="btn btn-outline-danger btn-sm btn-block" id="clearChat">
				Limpiar conversación
			</button>
			
		</div>

		<!-- CHAT (DERECHA) -->
		<div class="col-md-8 col-xl-9 chat">
						<div class="card">
							<div class="card-header msg_head">
								<div class="d-flex bd-highlight">
									<div class="img_cont">
										<img src="https://cdn-icons-png.flaticon.com/512/9439/9439123.png" class="rounded-circle user_img">
										<span class="online_icon"></span>
									</div>
									<div class="user_info">
										<span>Tu asistente virtual</span>
										<p>¿En que te puedo ayudar el día de hoy?</p>
									</div>
								</div>
							</div>
							<div id="messageFormeight" class="card-body msg_card_body">
								
								
							</div>
							<div class="card-footer">
								<form id="messageArea" class="input-group">
									<input type="text" id="text" name="msg" placeholder="..." autocomplete="off" class="form-control type_msg" required/>
									<div class="input-group-append">
										<button type="submit" id="send" class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		
			<script>
				$(document).ready(function() {
					$("#messageArea").on("submit", function(event) {
						const date = new Date();
						const hour = date.getHours();
						const minute = date.getMinutes();
						const str_time = hour+":"+minute;
						var rawText = $("#text").val();

						var userHtml = '<div class="d-flex justify-content-end mb-4"><div class="msg_cotainer_send">' + rawText + '<span class="msg_time_send">'+ str_time + '</span></div><div class="img_cont_msg"><img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg"></div></div>';
						
						$("#text").val("");
						$("#messageFormeight").append(userHtml);

						$.ajax({
							data: {
								msg: rawText,	
							},
							type: "POST",
							url: "/get",
						}).done(function(data) {
							var botHtml = '<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="https://cdn-icons-png.flaticon.com/512/9439/9439123.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer">' + data + '<span class="msg_time">' + str_time + '</span></div></div>';
							$("#messageFormeight").append($.parseHTML(botHtml));
						});
						event.preventDefault();
					});
				});


				$(document).ready(function(){

			// Mostrar modal automáticamente
			$('#termsModal').modal({
				backdrop: 'static',
				keyboard: false
			});

			$('#termsModal').modal('show');

			// Habilitar botón aceptar solo si marca el checkbox
			$('#acceptCheck').change(function(){
				if($(this).is(':checked')){
					$('#acceptBtn').prop('disabled', false);
				} else {
					$('#acceptBtn').prop('disabled', true);
				}
			});

			// Aceptar
			$('#acceptBtn').click(function(){
				localStorage.setItem("termsAccepted", "true");
				$('#termsModal').modal('hide');
			});

			// Rechazar
			$('#rejectBtn').click(function(){
				$("#messageArea :input").prop("disabled", true);
				alert("Debes aceptar los términos para usar el chatbot.");
			});

			// Si ya aceptó antes
			if(localStorage.getItem("termsAccepted") === "true"){
				$('#termsModal').modal('hide');
			}

		});

		//Limpiar conversación

		$("#clearChat").click(function(){

			// Vaciar los mensajes del chat
			$("#messageFormeight").empty();

			// Reiniciar contador 
			messageCount = 0;
			$("#msgCount").text("0");

		});
			</script>
        
    </body>
</html>